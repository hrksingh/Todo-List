import"./styles.css";import{format,addDays,differenceInDays,isWeekend}from"date-fns";import{todo}from"./todo";import{project as projectClass}from"./project";import{setStorage,getStorage}from"./localStorage";function uiController(){const e=document.querySelector(".addtask"),t=document.querySelector(".maincontent"),o=document.querySelector("dialog>form .cancel"),r=document.querySelector("dialog"),l=document.querySelector("dialog form>input"),n=document.querySelector("dialog form #description"),i=document.querySelector("form .submit");i.disabled=!0;const d=document.querySelector("#date-picker"),a=document.querySelector("dialog form .form-wrapper #priority"),c=document.querySelector("dialog form #addtoproject"),s=document.querySelector(".sidebar .today"),u=document.querySelector(".sidebar .upcoming"),p=document.querySelector(".sidebar .projects .myprojects"),m=document.getElementById("projectDialog"),f=document.getElementById("closeDialog"),y=document.querySelector(".projectInput"),b=document.querySelector("#submitProject"),v=document.querySelector(".project-list"),{AllTasks:g,AllProjects:k}=getStorage();let h="",x="";const S=(new Date).toISOString().slice(0,10);let E;if(d.setAttribute("min",S),-1==k.findIndex((e=>"Personal"==e.title))){const e=new projectClass("Personal");k.push(e),setStorage(k)}let C=!1;q(),setStorage(k),u.addEventListener("click",(()=>{u.classList.add("active"),w()})),u.click(),s.addEventListener("click",(()=>{u.classList.remove("active"),t.innerHTML="",g.forEach(((e,t)=>{e.date===S&&M(e.title,e.description,e.date,e.priority,e,t)}))}));const L=document.querySelectorAll("dialog form>input ,#date-picker,dialog form .form-wrapper #priority"),A=()=>{!1===C&&""==document.querySelector("dialog form>input").value||!d.value||"labeler"===a.value?i.disabled=!0:i.disabled=!1};function q(){v.innerHTML="";for(let e=1;e<c.length;e++)c[e].remove;k.forEach((e=>{const t=document.createElement("button");t.textContent=e.title,v.appendChild(t),"Personal"!=e.title&&(c.options[c.options.length]=new Option(`${e.title}`,`${e.title}`))})),v.querySelectorAll("*").forEach((e=>{e.addEventListener("click",(e=>{j(e.target.textContent)}))}))}function j(e){t.innerHTML="",k.forEach((t=>{t.title===e&&t.tasks.forEach((e=>{let t=g.findIndex((t=>t.title===e.title&&t.date===e.date));M(e.title,e.description,e.date,e.priority,e,t)}))})),console.log(e);let o=[...v.querySelectorAll("button")].find((t=>t.textContent==e));o&&o.focus()}function w(){t.innerHTML="",g.forEach(((e,t)=>{M(e.title,e.description,e.date,e.priority,e,t)}))}function M(e,o,i,s,u,p){const m=document.createElement("div"),f=document.createElement("input"),y=document.createElement("div"),b=document.createElement("button"),v=document.createElement("button");b.classList.add("edit-button"),b.innerHTML="&nbsp",v.classList.add("delete-button");let L="",A="";const q=new Date(i);L=format(q,"MMMM"),A=format(q,"dd"),y.classList.add("title-wrapper"),f.type="checkbox",f.value="completed",f.setAttribute("id","completed"),y.setAttribute("style","gap:5px; display:flex;margin-bottom: 3px;padding:7px 20px;border-bottom: 1px solid #eee; width:100%;"),m.classList.add("task-card");const w=document.createElement("label");b.setAttribute("data-index",`${p}`),v.setAttribute("data-index",`${p}`),w.setAttribute("for","completed"),w.setAttribute("id","heading");const M=document.createElement("p"),D=document.createElement("div");D.classList.add("date-display"),1==u.completed&&(console.log("checked"),f.checked=!0,w.setAttribute("style","text-decoration: line-through;color:gray"),D.setAttribute("style","color:gray;"),M.setAttribute("style","color:gray;"),b.disabled=!0,v.disabled=!0),f.addEventListener("change",(()=>{f.checked?(u.setCompleted(!0),w.setAttribute("style","text-decoration: line-through;color:gray"),D.setAttribute("style","color:gray;"),M.setAttribute("style","color:gray;"),b.disabled=!0,v.disabled=!0,console.log(u),setStorage(k)):(u.setCompleted(!1),w.setAttribute("style","text-decoration: none;color:black"),D.setAttribute("style","color:black;"),M.setAttribute("style","color:black;"),b.disabled=!1,v.disabled=!1,setStorage(k))})),b.addEventListener("click",(e=>{E=e.target.dataset.index,x=g[E],l.value=x.title,n.textContent=x.description,d.value=x.date,a.value=x.priority,c.value=I(x),h=c.value,C=!0,r.showModal()})),v.addEventListener("click",(e=>{let t;E=e.target.dataset.index;const o=g[E];for(const e of k){const r=e.tasks.findIndex((e=>e.title===o.title));if(-1!=r){e.tasks.splice(r,1),t=e.title;break}}g.splice(E,1),j(t),setStorage(k)})),"high"===s?m.setAttribute("style","border-top:10px solid red;"):"medium"===s?m.setAttribute("style","border-top:10px solid yellow;"):"low"===s&&m.setAttribute("style","border-top:10px solid green;"),w.textContent=e,i<S&&D.setAttribute("style","color:#db0000;"),M.textContent=o,D.textContent=`${A} ${L}`,y.appendChild(f),y.appendChild(w),y.appendChild(b),y.appendChild(v),m.appendChild(y),m.appendChild(M),m.appendChild(D),t.appendChild(m)}function I(e){for(const t of k)if(t.tasks.includes(e))return t.title;return"Personal"}L.forEach((e=>{e.addEventListener("input",A)})),p.addEventListener("click",(()=>{m.showModal()})),f.addEventListener("click",(()=>{y.value="",m.close()})),b.addEventListener("click",(()=>{if(y.value.trim()){const e=y.value[0].toUpperCase()+y.value.slice(1),t=new projectClass(e);k.push(t),f.click(),setStorage(k)}else y.reportValidity();q()})),i.addEventListener("click",(e=>{if(e.preventDefault(),0==C){let e=k.findIndex((e=>e.title===c.value));const t=new todo(l.value,n.textContent,d.value,a.value);k[e].addtoproject(t),g.push(t),setStorage(k),o.click(),u.click(),u.focus()}else if(1==C&&-1!=E){if(x.title==l.value&&x.description==n.textContent&&x.date==d.value&&x.priority==a.value&&h==I(x))return void o.click();const e=k.findIndex((e=>e.title===c.value));if(-1===e)return void console.error("Project not found!");const t=k.findIndex((e=>e.tasks.includes(g[E])));-1!==t&&t!==e&&(k[t].tasks=k[t].tasks.filter((e=>e!==g[E])),k[e].tasks.push(g[E])),g[E].updateTodo(l.value,n.textContent,d.value,a.value),w(),console.log(g),C=!1,setStorage(k),o.click()}else alert("error")})),e.addEventListener("click",(()=>{u.classList.remove("active"),r.showModal()})),o.addEventListener("click",(t=>{t.preventDefault(),e.blur(),l.value="",n.textContent="",d.value="",a.value="labeler",r.close(),w()}))}document.addEventListener("DOMContentLoaded",(()=>{uiController()}));